apiVersion: apps/v1
kind: Deployment
metadata:
  name: caddy
  namespace: homepage
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: homepage
      app.kubernetes.io/component: caddy
  template:
    metadata:
      labels:
        app.kubernetes.io/name: homepage
        app.kubernetes.io/component: caddy
    spec:
      containers:
        - image: caddy:2-alpine
          name: caddy
          command:
            - caddy
            - file-server
            - --root
            - /static
            - --access-log
          volumeMounts:
            - name: matrix-well-known
              mountPath: /static/.well-known/matrix
            - name: webfinger
              mountPath: /static/webfinger
      volumes:
        - name: matrix-well-known
          configMap:
            name: matrix-well-known
        - name: webfinger
          configMap:
            name: webfinger
