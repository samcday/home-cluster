---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: seaweedfs
  namespace: seaweedfs
spec:
  chart:
    spec:
      chart: k8s/charts/seaweedfs
      reconcileStrategy: Revision
      sourceRef:
        kind: GitRepository
        name: samcday-seaweedfs
  interval: 5m
  values:
    # https://github.com/seaweedfs/seaweedfs/blob/master/k8s/charts/seaweedfs/values.yaml
    filer:
      data: &datapvc
        type: persistentVolumeClaim
        size: 10Gi
        storageClass: syncthing
      logs: &logs
        hostPathPrefix: /var/seaweedfs
      encryptVolumeData: true
    global:
      monitoring:
        enabled: true
    master:
      data: *datapvc
      logs: *logs
    volume:
      replicas: 1
      nodeSelector: |-
        kubernetes.io/hostname: librem13.hominions.tailnet.samcday.com
      data: &vol
        hostPathPrefix: /srv/seaweedfs-volume
      index: leveldb
      idx: *vol
      logs: *vol
      maxVolumes: 100
